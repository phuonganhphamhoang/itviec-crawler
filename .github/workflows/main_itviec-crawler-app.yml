# Docs for the Azure Web Apps Deploy action: https://github.com/Azure/webapps-deploy
# More GitHub Actions for Azure: https://github.com/Azure/actions
# More info on Python, GitHub Actions, and Azure App Service: https://aka.ms/python-webapps-actions

name: ITviec Crawler (GitHub Action Runner)

on:
  schedule:
    - cron: "*/10 * * * *" # üîÅ ch·∫°y m·ªói 10 ph√∫t
  workflow_dispatch:        # c√≥ th·ªÉ ch·∫°y th·ªß c√¥ng t·ª´ tab Actions

jobs:
  crawl:
    runs-on: ubuntu-latest
    env:
      AZURE_STORAGE_CONNECTION_STRING: ${{ secrets.AZURE_STORAGE_CONNECTION_STRING }}

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y --no-install-recommends libnss3 libxss1 libxrandr2 || true
          pip install --upgrade pip
          pip install playwright azure-storage-blob
          python -m playwright install --with-deps chromium

      - name: Run crawler
        run: |
          python itviec_crawler_cloud.py || true
          echo "====== Debug HTMLs ======"
          ls -lh debug_page_* || true

      - name: Upload logs as artifact (optional)
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: crawl-logs
          path: |
            jobs_data_public.json
            debug_page_*.*

